<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://static.opentok.com/v2/js/opentok.min.js"></script>
  <script src="dist/core.js"></script>
  <title>OT Accelerator Core Sample</title>

</head>

<body>

  <div id="publishers"></div>
  <div id="subscribers"></div>

  <script type="text/javascript">
    const options = {
      credentials: {
        apiKey: '47072384',
        sessionId: '2_MX40NzA3MjM4NH5-MTYxMDA1NzQzODU4N35nTWd2bEk2SlBPZHVGRmJabXdJTk1rVnB-fg',
        token: 'T1==cGFydG5lcl9pZD00NzA3MjM4NCZzaWc9NWQ4NDMwOTMxZDM4NmJkMTgyODFjYWIyYjVjNWY1MTg5MzhiMWE4MzpzZXNzaW9uX2lkPTJfTVg0ME56QTNNak00Tkg1LU1UWXhNREExTnpRek9EVTROMzVuVFdkMmJFazJTbEJQWkhWR1JtSmFiWGRKVGsxclZuQi1mZyZjcmVhdGVfdGltZT0xNjEwMDU3NDQ4Jm5vbmNlPTAuMDYyNjcxMDQ4NzQ4MzcxMjYmcm9sZT1wdWJsaXNoZXImZXhwaXJlX3RpbWU9MTYxMDA2MTA0NiZpbml0aWFsX2xheW91dF9jbGFzc19saXN0PQ=='
      }
    };
    const callProperties = {
      insertMode: 'append',
      width: '100%',
      height: '100%',
      showControls: true
    };

    const otCore = new AccCore(options);

    const subscribeToStream = stream => {
      const type = stream.videoType;
      otSDK.subscribe(stream, `${type}SubscriberContainer`, callProperties);
    };

    otCore.connect().then(() => {

      const session = otCore.getSession();

      session.streams.forEach(subscribeToStream);

      otCore.on({
        'streamCreated': ({ stream }) => subscribeToStream(stream)
      });

      otCore.startCall('publishers', callProperties).then((publisher) => {

      }).catch(error => console.log(error));
    });

  </script>
</body>

</html>
